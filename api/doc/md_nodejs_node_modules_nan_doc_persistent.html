<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.8.18"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Engage Engine API: Persistent references</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">Engage Engine API
								&#160;<span id="projectnumber">1.221.9059</span>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_nodejs_node_modules_nan_doc_persistent.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="class_persistent.html">Persistent</a> references </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>An object reference that is independent of any <code>HandleScope</code> is a <em>persistent</em> reference. Where a <code>Local</code> handle only lives as long as the <code>HandleScope</code> in which it was allocated, a <code><a class="el" href="class_persistent.html">Persistent</a></code> handle remains valid until it is explicitly disposed.</p>
<p>Due to the evolution of the V8 API, it is necessary for NAN to provide a wrapper implementation of the <code><a class="el" href="class_persistent.html">Persistent</a></code> classes to supply compatibility across the V8 versions supported.</p>
<ul>
<li><a href="#api_nan_persistent_base"><b><code>Nan::PersistentBase &amp; v8::PersistentBase</code></b></a></li>
<li><a href="#api_nan_non_copyable_persistent_traits"><b><code>Nan::NonCopyablePersistentTraits &amp; v8::NonCopyablePersistentTraits</code></b></a></li>
<li><a href="#api_nan_copyable_persistent_traits"><b><code>Nan::CopyablePersistentTraits &amp; v8::CopyablePersistentTraits</code></b></a></li>
<li><a href="#api_nan_persistent"><b><code>Nan::Persistent</code></b></a></li>
<li><a href="#api_nan_global"><b><code>Nan::Global</code></b></a></li>
<li><a href="#api_nan_weak_callback_info"><b><code>Nan::WeakCallbackInfo</code></b></a></li>
<li><a href="#api_nan_weak_callback_type"><b><code>Nan::WeakCallbackType</code></b></a></li>
</ul>
<p>Also see the V8 Embedders Guide section on <a href="https://developers.google.com/v8/embed#handles">Handles and Garbage Collection</a>.</p>
<p><a class="anchor" id="api_nan_persistent_base"></a> </p>
<h2><a class="anchor" id="autotoc_md923"></a>
Nan::PersistentBase &amp; v8::PersistentBase</h2>
<p>A persistent handle contains a reference to a storage cell in V8 which holds an object value and which is updated by the garbage collector whenever the object is moved. A new storage cell can be created using the constructor or <code>Nan::PersistentBase::Reset()</code>. Existing handles can be disposed using an argument-less <code>Nan::PersistentBase::Reset()</code>.</p>
<p>Definition:</p>
<p>_(note: this is implemented as <code><a class="el" href="class_nan_1_1_persistent_base.html">Nan::PersistentBase</a></code> for older versions of V8 and the native <code>v8::PersistentBase</code> is used for newer versions of V8)_</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">template&lt;typename T&gt; class PersistentBase {</div>
<div class="line"> public:</div>
<div class="line">  /**</div>
<div class="line">   * If non-empty, destroy the underlying storage cell</div>
<div class="line">   */</div>
<div class="line">  void Reset();</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * If non-empty, destroy the underlying storage cell and create a new one with</div>
<div class="line">   * the contents of another if it is also non-empty</div>
<div class="line">   */</div>
<div class="line">  template&lt;typename S&gt; void Reset(const v8::Local&lt;S&gt; &amp;other);</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * If non-empty, destroy the underlying storage cell and create a new one with</div>
<div class="line">   * the contents of another if it is also non-empty</div>
<div class="line">   */</div>
<div class="line">  template&lt;typename S&gt; void Reset(const PersistentBase&lt;S&gt; &amp;other);</div>
<div class="line"> </div>
<div class="line">  /** Returns true if the handle is empty. */</div>
<div class="line">  bool IsEmpty() const;</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * If non-empty, destroy the underlying storage cell</div>
<div class="line">   * IsEmpty() will return true after this call.</div>
<div class="line">   */</div>
<div class="line">  void Empty();</div>
<div class="line"> </div>
<div class="line">  template&lt;typename S&gt; bool operator==(const PersistentBase&lt;S&gt; &amp;that);</div>
<div class="line"> </div>
<div class="line">  template&lt;typename S&gt; bool operator==(const v8::Local&lt;S&gt; &amp;that);</div>
<div class="line"> </div>
<div class="line">  template&lt;typename S&gt; bool operator!=(const PersistentBase&lt;S&gt; &amp;that);</div>
<div class="line"> </div>
<div class="line">  template&lt;typename S&gt; bool operator!=(const v8::Local&lt;S&gt; &amp;that);</div>
<div class="line"> </div>
<div class="line">   /**</div>
<div class="line">   *  Install a finalization callback on this object.</div>
<div class="line">   *  NOTE: There is no guarantee as to *when* or even *if* the callback is</div>
<div class="line">   *  invoked. The invocation is performed solely on a best effort basis.</div>
<div class="line">   *  As always, GC-based finalization should *not* be relied upon for any</div>
<div class="line">   *  critical form of resource management! At the moment you can either</div>
<div class="line">   *  specify a parameter for the callback or the location of two internal</div>
<div class="line">   *  fields in the dying object.</div>
<div class="line">   */</div>
<div class="line">  template&lt;typename P&gt;</div>
<div class="line">  void SetWeak(P *parameter,</div>
<div class="line">               typename WeakCallbackInfo&lt;P&gt;::Callback callback,</div>
<div class="line">               WeakCallbackType type);</div>
<div class="line"> </div>
<div class="line">  void ClearWeak();</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * Marks the reference to this object independent. Garbage collector is free</div>
<div class="line">   * to ignore any object groups containing this object. Weak callback for an</div>
<div class="line">   * independent handle should not assume that it will be preceded by a global</div>
<div class="line">   * GC prologue callback or followed by a global GC epilogue callback.</div>
<div class="line">   */</div>
<div class="line">  void MarkIndependent() const;</div>
<div class="line"> </div>
<div class="line">  bool IsIndependent() const;</div>
<div class="line"> </div>
<div class="line">  /** Checks if the handle holds the only reference to an object. */</div>
<div class="line">  bool IsNearDeath() const;</div>
<div class="line"> </div>
<div class="line">  /** Returns true if the handle&#39;s reference is weak.  */</div>
<div class="line">  bool IsWeak() const</div>
<div class="line">};</div>
</div><!-- fragment --><p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.16/d4/dca/classv8_1_1_persistent_base.html"><code>PersistentBase</code></a> for further information.</p>
<p><b>Tip:</b> To get a <code>v8::Local</code> reference to the original object back from a <code><a class="el" href="class_persistent_base.html">PersistentBase</a></code> or <code><a class="el" href="class_persistent.html">Persistent</a></code> object:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">v8::Local&lt;v8::Object&gt; object = Nan::New(persistent);</div>
</div><!-- fragment --><p><a class="anchor" id="api_nan_non_copyable_persistent_traits"></a> </p>
<h2><a class="anchor" id="autotoc_md924"></a>
Nan::NonCopyablePersistentTraits &amp; v8::NonCopyablePersistentTraits</h2>
<p>Default traits for <code><a class="el" href="class_nan_1_1_persistent.html">Nan::Persistent</a></code>. This class does not allow use of the a copy constructor or assignment operator. At present <code>kResetInDestructor</code> is not set, but that will change in a future version.</p>
<p>Definition:</p>
<p>_(note: this is implemented as <code><a class="el" href="class_nan_1_1_non_copyable_persistent_traits.html">Nan::NonCopyablePersistentTraits</a></code> for older versions of V8 and the native <code>v8::NonCopyablePersistentTraits</code> is used for newer versions of V8)_</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">template&lt;typename T&gt; class NonCopyablePersistentTraits {</div>
<div class="line"> public:</div>
<div class="line">  typedef Persistent&lt;T, NonCopyablePersistentTraits&lt;T&gt; &gt; NonCopyablePersistent;</div>
<div class="line"> </div>
<div class="line">  static const bool kResetInDestructor = false;</div>
<div class="line"> </div>
<div class="line">  template&lt;typename S, typename M&gt;</div>
<div class="line">  static void Copy(const Persistent&lt;S, M&gt; &amp;source,</div>
<div class="line">                   NonCopyablePersistent *dest);</div>
<div class="line"> </div>
<div class="line">  template&lt;typename O&gt; static void Uncompilable();</div>
<div class="line">};</div>
</div><!-- fragment --><p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.16/de/d73/classv8_1_1_non_copyable_persistent_traits.html"><code>NonCopyablePersistentTraits</code></a> for further information.</p>
<p><a class="anchor" id="api_nan_copyable_persistent_traits"></a> </p>
<h2><a class="anchor" id="autotoc_md925"></a>
Nan::CopyablePersistentTraits &amp; v8::CopyablePersistentTraits</h2>
<p>A helper class of traits to allow copying and assignment of <code><a class="el" href="class_persistent.html">Persistent</a></code>. This will clone the contents of storage cell, but not any of the flags, etc..</p>
<p>Definition:</p>
<p>_(note: this is implemented as <code>Nan::CopyablePersistentTraits</code> for older versions of V8 and the native <code>v8::NonCopyablePersistentTraits</code> is used for newer versions of V8)_</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">template&lt;typename T&gt;</div>
<div class="line">class CopyablePersistentTraits {</div>
<div class="line"> public:</div>
<div class="line">  typedef Persistent&lt;T, CopyablePersistentTraits&lt;T&gt; &gt; CopyablePersistent;</div>
<div class="line"> </div>
<div class="line">  static const bool kResetInDestructor = true;</div>
<div class="line"> </div>
<div class="line">  template&lt;typename S, typename M&gt;</div>
<div class="line">  static void Copy(const Persistent&lt;S, M&gt; &amp;source,</div>
<div class="line">                   CopyablePersistent *dest);</div>
<div class="line">};</div>
</div><!-- fragment --><p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.16/da/d5c/structv8_1_1_copyable_persistent_traits.html"><code>CopyablePersistentTraits</code></a> for further information.</p>
<p><a class="anchor" id="api_nan_persistent"></a> </p>
<h2><a class="anchor" id="autotoc_md926"></a>
Nan::Persistent</h2>
<p>A type of <code><a class="el" href="class_persistent_base.html">PersistentBase</a></code> which allows copy and assignment. Copy, assignment and destructor behavior is controlled by the traits class <code>M</code>.</p>
<p>Definition:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">template&lt;typename T, typename M = NonCopyablePersistentTraits&lt;T&gt; &gt;</div>
<div class="line">class Persistent;</div>
<div class="line"> </div>
<div class="line">template&lt;typename T, typename M&gt; class Persistent : public PersistentBase&lt;T&gt; {</div>
<div class="line"> public:</div>
<div class="line"> /**</div>
<div class="line">  * A Persistent with no storage cell.</div>
<div class="line">  */</div>
<div class="line">  Persistent();</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * Construct a Persistent from a v8::Local. When the v8::Local is non-empty, a</div>
<div class="line">   * new storage cell is created pointing to the same object, and no flags are</div>
<div class="line">   * set.</div>
<div class="line">   */</div>
<div class="line">  template&lt;typename S&gt; Persistent(v8::Local&lt;S&gt; that);</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * Construct a Persistent from a Persistent. When the Persistent is non-empty,</div>
<div class="line">   * a new storage cell is created pointing to the same object, and no flags are</div>
<div class="line">   * set.</div>
<div class="line">   */</div>
<div class="line">  Persistent(const Persistent &amp;that);</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * The copy constructors and assignment operator create a Persistent exactly</div>
<div class="line">   * as the Persistent constructor, but the Copy function from the traits class</div>
<div class="line">   * is called, allowing the setting of flags based on the copied Persistent.</div>
<div class="line">   */</div>
<div class="line">  Persistent &amp;operator=(const Persistent &amp;that);</div>
<div class="line"> </div>
<div class="line">  template &lt;typename S, typename M2&gt;</div>
<div class="line">  Persistent &amp;operator=(const Persistent&lt;S, M2&gt; &amp;that);</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * The destructor will dispose the Persistent based on the kResetInDestructor</div>
<div class="line">   * flags in the traits class.  Since not calling dispose can result in a</div>
<div class="line">   * memory leak, it is recommended to always set this flag.</div>
<div class="line">   */</div>
<div class="line">  ~Persistent();</div>
<div class="line">};</div>
</div><!-- fragment --><p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.16/d2/d78/classv8_1_1_persistent.html"><code>Persistent</code></a> for further information.</p>
<p><a class="anchor" id="api_nan_global"></a> </p>
<h2><a class="anchor" id="autotoc_md927"></a>
Nan::Global</h2>
<p>A type of <code><a class="el" href="class_persistent_base.html">PersistentBase</a></code> which has move semantics.</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">template&lt;typename T&gt; class Global : public PersistentBase&lt;T&gt; {</div>
<div class="line"> public:</div>
<div class="line">  /**</div>
<div class="line">   * A Global with no storage cell.</div>
<div class="line">   */</div>
<div class="line">  Global();</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * Construct a Global from a v8::Local. When the v8::Local is non-empty, a new</div>
<div class="line">   * storage cell is created pointing to the same object, and no flags are set.</div>
<div class="line">   */</div>
<div class="line">  template&lt;typename S&gt; Global(v8::Local&lt;S&gt; that);</div>
<div class="line">  /**</div>
<div class="line">   * Construct a Global from a PersistentBase. When the Persistent is non-empty,</div>
<div class="line">   * a new storage cell is created pointing to the same object, and no flags are</div>
<div class="line">   * set.</div>
<div class="line">   */</div>
<div class="line">  template&lt;typename S&gt; Global(const PersistentBase&lt;S&gt; &amp;that);</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * Pass allows returning globals from functions, etc.</div>
<div class="line">   */</div>
<div class="line">  Global Pass();</div>
<div class="line">};</div>
</div><!-- fragment --><p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.16/d5/d40/classv8_1_1_global.html"><code>Global</code></a> for further information.</p>
<p><a class="anchor" id="api_nan_weak_callback_info"></a> </p>
<h2><a class="anchor" id="autotoc_md928"></a>
Nan::WeakCallbackInfo</h2>
<p><code><a class="el" href="class_nan_1_1_weak_callback_info.html">Nan::WeakCallbackInfo</a></code> is used as an argument when setting a persistent reference as weak. You may need to free any external resources attached to the object. It is a mirror of <code>v8:<a class="el" href="class_weak_callback_info.html">WeakCallbackInfo</a></code> as found in newer versions of V8.</p>
<p>Definition:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">template&lt;typename T&gt; class WeakCallbackInfo {</div>
<div class="line"> public:</div>
<div class="line">  typedef void (*Callback)(const WeakCallbackInfo&lt;T&gt;&amp; data);</div>
<div class="line"> </div>
<div class="line">  v8::Isolate *GetIsolate() const;</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * Get the parameter that was associated with the weak handle.</div>
<div class="line">   */</div>
<div class="line">  T *GetParameter() const;</div>
<div class="line"> </div>
<div class="line">  /**</div>
<div class="line">   * Get pointer from internal field, index can be 0 or 1.</div>
<div class="line">   */</div>
<div class="line">  void *GetInternalField(int index) const;</div>
<div class="line">};</div>
</div><!-- fragment --><p>Example usage:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">void weakCallback(const WeakCallbackInfo&lt;int&gt; &amp;data) {</div>
<div class="line">  int *parameter = data.GetParameter();</div>
<div class="line">  delete parameter;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Persistent&lt;v8::Object&gt; obj;</div>
<div class="line">int *data = new int(0);</div>
<div class="line">obj.SetWeak(data, callback, WeakCallbackType::kParameter);</div>
</div><!-- fragment --><p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.16/d8/d06/classv8_1_1_weak_callback_info.html"><code>WeakCallbackInfo</code></a> for further information.</p>
<p><a class="anchor" id="api_nan_weak_callback_type"></a> </p>
<h2><a class="anchor" id="autotoc_md929"></a>
Nan::WeakCallbackType</h2>
<p>Represents the type of a weak callback. A weak callback of type <code>kParameter</code> makes the supplied parameter to <code>Nan::PersistentBase::SetWeak</code> available through <code>WeakCallbackInfo::GetParameter</code>. A weak callback of type <code>kInternalFields</code> uses up to two internal fields at indices 0 and 1 on the <code><a class="el" href="class_nan_1_1_persistent_base.html">Nan::PersistentBase</a>&lt;v8::Object&gt;</code> being made weak. Note that only <code>v8::Object</code>s and derivatives can have internal fields.</p>
<p>Definition:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">enum class WeakCallbackType { kParameter, kInternalFields };</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<li class="footer">
					Generated on Sun Apr 3 2022 12:33:25 for Engage Engine API by <a href="http://www.doxygen.org/index.html">
					<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18.
					Dark theme by <a href="http://majerle.eu" target="_new">Tilen Majerle</a>. All rights reserved.
				</li>
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>