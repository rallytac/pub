<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.8.18"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Engage Engine API: socks examples</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">Engage Engine API
								&#160;<span id="projectnumber">1.221.9059</span>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_nodejs_node_modules_socks_docs_examples_javascript_associate_example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">socks examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1589"></a>
Example for SOCKS 'associate' command</h1>
<p>The associate command tells the SOCKS proxy server to establish a UDP relay. The server binds to a new UDP port and communicates the newly opened port back to the origin client. From here, any SOCKS UDP frame packets sent to this special UDP port on the Proxy server will be forwarded to the desired destination, and any responses will be forwarded back to the origin client (you).</p>
<p>This can be used for things such as DNS queries, and other UDP communicates.</p>
<p><b>Connection Steps</b></p>
<ol type="1">
<li>Client -(associate)-&gt; Proxy (Tells the proxy to create a UDP relay and bind on a new port)</li>
<li>Client &lt;-(port)- Proxy (Tells the origin client which port it opened and is accepting UDP frame packets on)</li>
</ol>
<p>At this point the proxy is accepting UDP frames on the specified port.</p>
<ol type="1">
<li>Client &ndash;(udp frame) -&gt; Proxy -&gt; Destination (The origin client sends a UDP frame to the proxy on the UDP port, and the proxy then forwards it to the destination specified in the UDP frame.)</li>
<li>Client &lt;&ndash;(udp frame) &lt;&ndash; Proxy &lt;&ndash; Destination (The destination client responds to the udp packet sent in #3)</li>
</ol>
<h1><a class="anchor" id="autotoc_md1590"></a>
Usage</h1>
<p>The 'associate' command can only be used by creating a new SocksClient instance and listening for the 'established' event.</p>
<p><b>Note:</b> UDP packets relayed through the proxy servers are encompassed in a special Socks UDP frame format. SocksClient.createUDPFrame() and SocksClient.parseUDPFrame() create and parse these special UDP packets.</p>
<div class="fragment"><div class="line">const dgram = require(&#39;dgram&#39;);</div>
<div class="line">const SocksClient = require(&#39;socks&#39;).SocksClient;</div>
<div class="line"> </div>
<div class="line">// Create a local UDP socket for sending/receiving packets to/from the proxy.</div>
<div class="line">const udpSocket = dgram.createSocket(&#39;udp4&#39;);</div>
<div class="line">udpSocket.bind();</div>
<div class="line"> </div>
<div class="line">// Listen for incoming UDP packets from the proxy server.</div>
<div class="line">udpSocket.on(&#39;message&#39;, (message, rinfo) =&gt; {</div>
<div class="line">  console.log(SocksClient.parseUDPFrame(message));</div>
<div class="line">  /*</div>
<div class="line">  { frameNumber: 0,</div>
<div class="line">    remoteHost: { host: &#39;8.8.8.8&#39;, port: 53 }, // The remote host that replied with a UDP packet</div>
<div class="line">    data: &lt;Buffer 74 65 73 74 0a&gt; // The data</div>
<div class="line">  }</div>
<div class="line">  */</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">const options = {</div>
<div class="line">  proxy: {</div>
<div class="line">    host: &#39;104.131.124.203&#39;,</div>
<div class="line">    port: 1081,</div>
<div class="line">    type: 5</div>
<div class="line">  },</div>
<div class="line"> </div>
<div class="line">  // This should be the ip and port of the expected client that will be sending UDP frames to the newly opened UDP port on the server.</div>
<div class="line">  // Most SOCKS servers accept 0.0.0.0 as a wildcard address to accept UDP frames from any source.</div>
<div class="line">  destination: {</div>
<div class="line">    host: &#39;0.0.0.0&#39;,</div>
<div class="line">    port: 0</div>
<div class="line">  },</div>
<div class="line"> </div>
<div class="line">  command: &#39;associate&#39;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">const client = new SocksClient(options);</div>
<div class="line"> </div>
<div class="line">// This event is fired when the SOCKS server has started listening on a new UDP port for UDP relaying.</div>
<div class="line">client.on(&#39;established&#39;, info =&gt; {</div>
<div class="line">  console.log(info);</div>
<div class="line">  /*</div>
<div class="line">  {</div>
<div class="line">    socket: &lt;Socket ...&gt;,</div>
<div class="line">    remoteHost: { // This is the remote port on the SOCKS proxy server to send UDP frame packets to.</div>
<div class="line">      host: &#39;104.131.124.203&#39;,</div>
<div class="line">      port: 58232</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  */</div>
<div class="line"> </div>
<div class="line">  // Send a udp frame to 8.8.8.8 on port 53 through the proxy.</div>
<div class="line">  const packet = SocksClient.createUDPFrame({</div>
<div class="line">    remoteHost: { host: &#39;8.8.8.8&#39;, port: 53 },</div>
<div class="line">    data: Buffer.from(&#39;hello&#39;) // A DNS lookup in the real world.</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  // Send packet.</div>
<div class="line">  udpSocket.send(packet, info.remoteHost.port, info.remoteHost.host);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">// SOCKS proxy failed to bind.</div>
<div class="line">client.on(&#39;error&#39;, () =&gt; {</div>
<div class="line">  // Handle errors</div>
<div class="line">});</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<li class="footer">
					Generated on Sun Apr 3 2022 12:33:25 for Engage Engine API by <a href="http://www.doxygen.org/index.html">
					<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18.
					Dark theme by <a href="http://majerle.eu" target="_new">Tilen Majerle</a>. All rights reserved.
				</li>
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>